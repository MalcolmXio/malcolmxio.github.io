# Pagination

Без пагинации запрос может возвращать чрезмерно большое количество данных. Это может негативно сказаться на нагрузке на сеть а также на потреблении памяти.

## Offset pagination

В запрос предоставляем параметры `offset` и `limit`. Пример: `GET /feed?offset=100&limit=20`

Плюсы:

- легко реализовать
- не хранит состояние на сервере

Минусы:

- плохая производительность при больших значениях сдвига. БД должна скипнуть большое количество значений, прежде чем вернет результат
- нет гарантий консистентности данных при добавлении новых записей в БД

## Keyset pagination

Используются значения из последнего запроса, чтобы вернуть новый набор элементов. Пример: `GET /feed?after=2021-05-25T00:00:00&limit=20`

Плюсы:

- легко преобразовать в SQL запрос
- хорошая производительность на больших выборках данных
- не хранит состояние на сервере

Минусы:

- механизм становится зависимым от нижележащих данных в таблице
- работает только с полями с естественным упорядочением

## Cursor/seek pagination

Оперирует со стабильными идентификаторами, которые не связаны с SQL запросами (обычно выбранное поле кодируется в base64 и шифруется на бэке). Пример: `GET /feed?after_id=t1234xzy&limit=20`

Плюсы:

- отделение пагинации от SQL БД
- консистентный порядок при добавлении новых записей

Минусы:

- сложная имплементация на бэке
- не очень хоршо работает если элементы можно удалять (айдишники становятся невалидными)

Пример запроса с cursor пагинацией:

```Json
GET /v1/feed?after_id=p1234xzy&limit=20
Authorization: Bearer <token>
{
  "data": {
    "items": [
      {
        "id": "t123",
        "author_id": "a123",
        "title": "Title",
        "description": "Description",
        "likes": 12345,
        "comments": 10,
        "attachments": {
          "media": [
            {
              "image_url": "https://static.cdn.com/image1234.webp",
              "thumb_url": "https://static.cdn.com/thumb1234.webp"
            },
            ...
          ]
        },
        "created_at": "2021-05-25T17:59:59.000Z"
      },
      ...
    ]
  },
  "cursor": {
    "count": 20,
    "next_id": "p1235xzy",
    "prev_id": null
  }
}
```
