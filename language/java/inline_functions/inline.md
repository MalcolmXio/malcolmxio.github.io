# Inline функции

Inline функция - оптимизация для работы с вложенными функциями (лямбдами), которая позволяет не создавать для лямбды объект

## Reified

Ключевое слово Reified позволяет встраивать тип как-есть, не стирая его на этапе компиляции.

Плюсы:

- избавляемся от рефлексии и ускоряем работу функции

```Kotlin
inline fun <reified T> TreeNode.findParentOfType(): T? {
    var p = parent
    while (p != null && p !is T) {
        p = p.parent
    }
    return p as T?
}
```

## Noinline

`noinline` позволяет не встраивать определенный параметр inline функции.

## Non-local return

В обычных лямбдах нельзя использовать return для выхода из функции. Чтобы выйти из лямбды, нужно использовать label.

Однако, если лямбда встраивается, то и return можно встроить. Такие return-ы, находящиеся внутри лямбды, но позволяющие выйти из функции, вызывающей эту лямбду, называются нелокальными.

В некоторых случаях, контекст в котором выполняется лямбда, может быть отличным от inline функции, в которую она передается. В таких случаях, нелокальный return запрещен в лямбде. Чтобы указать компилятору, что данная лямбда не может использовать нелокальный return, используется ключевое слово `crossinline`.

```Kotlin
inline fun f(crossinline body: () -> Unit) {
    val f = object: Runnable {
        override fun run() = body()
    }
    // ...
}
```

## Tradeoffs

- не могут оперировать с приватными или internal функциями/свойствами. То-есть они не подходят если мы хотим скрыть имплементацию
- не могут быть рекурсивными
- рост размеров байт-кода в файле по причине постоянного копирования блока кода в месте вызова
